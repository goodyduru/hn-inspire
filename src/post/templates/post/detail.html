{% load hnfilters %}
{% block content %}
<section>
    {% if post.parent_id == None %}
    <header>
        {% if user.is_authenticated and post.user_voted == None %}
        <a href="/vote?id={{ post.id }}">^</a>
        {% endif %}
        {% if post.url != "" %}
        <h2><a href="{{post.url}}">{{post.title}}</a></h2>
        {% else %}
        <h2>{{post.title}}</h2>
        {% endif %}
        <div>
            <span>{{post.votes}} point{{ post.votes | pluralize }} by </span>
            <span><a href="/user?id={{post.username}}">{{post.username}}</a></span>
            <span>{{post.created_at|timesince}} ago</span> |
            <span>
                {% if user.is_authenticated %}
                    {% if post.user_flagged == None %}
                    <a href="/flag?id={{ post.id }}">flag</a>
                    {% else %}
                    <a href="/flag?id={{ post.id }}&action=un">flag</a>
                    {% endif %}
                    |
                {% endif %} 
            </span>
            <span>
                <a href="/item?id={{ post.id }}">
                    {% if comment_list %}
                    {{comment_list|length}} comment{{ comment_list|length|pluralize }}
                    {% else %}
                        discuss
                    {% endif %}
                </a>
            </span>
        </div>
    </header>
    {% if post.text != "" %}
    <article>{{post.text}}</article>
    {% endif %}
    {% else %}
    <header>
        <div>
            {% if user.is_authenticated and post.user_voted == None %}
            <a href="/vote?id={{ post.id }}">^</a>
            {% endif %}
            <span><a href="/user?id={{post.username}}">{{post.username}}</a></span>
            <span>{{post.created_at|timesince}} ago</span> |
            <span><a href="/item?id={{post.parent_id}}">parent</a></span> |
            <span><a href="/item?id={{post.parent_id}}#{{post.id}}">context</a></span>
        </div>
    </header>
    <article>{{post.text}}</article>
    {% endif %}
</section>
{% if user.is_authenticated %}
<form method="post" action="{% url 'comment' %}">
{% csrf_token %}
{{ form }}

<input type="submit" value="comment">
<input type="hidden" name="next" value="{{ next }}">
</form>
{% endif %}

{% if comment_list %}
<ul>
    {% for comment in comment_list %}
    <li id="{{comment.id}}" style="{{comment.lev|indent}}">
        <header>
            {% if user.is_authenticated and post.user_voted == None %}
            <a href="/vote?id={{ comment.id }}">^</a>
            {% endif %}
            <span><a href="/user?id={{comment.username}}">{{comment.username}}</a></span>
            <span><a href="/item?id={{ comment.id }}">{{comment.created_at|timesince}} ago</a></span>
            <span>
                {% if user.is_authenticated %}
                    {% if post.user_flagged == None %}
                    <a href="/flag?id={{ post.id }}">flag</a>
                    {% else %}
                    <a href="/flag?id={{ post.id }}&action=un">flag</a>
                    {% endif %}
                    |
                {% endif %} 
            </span>
        </header>
        <article>{{comment.text}}</article>
    </li>
    {% endfor %}
</ul>
{% endif %}
{% endblock %}